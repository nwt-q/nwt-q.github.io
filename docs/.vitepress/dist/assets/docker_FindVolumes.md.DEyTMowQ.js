import{_ as e,C as n,c as t,o as l,j as a,G as p,a8 as r,a as o}from"./chunks/framework.DMZhn_gK.js";const d="/assets/image-20251209153907335.CKCk39Ci.png",E=JSON.parse('{"title":"Docker 数据卷访问失败","description":"","frontmatter":{},"headers":[],"relativePath":"docker/FindVolumes.md","filePath":"docker/FindVolumes.md","lastUpdated":1765425247000}'),h={name:"docker/FindVolumes.md"};function k(c,s,u,g,b,F){const i=n("ArticleMetadata");return l(),t("div",null,[s[0]||(s[0]=a("h1",{id:"docker-数据卷访问失败",tabindex:"-1"},[o("Docker 数据卷访问失败 "),a("a",{class:"header-anchor",href:"#docker-数据卷访问失败","aria-label":'Permalink to "Docker 数据卷访问失败"'},"​")],-1)),p(i),s[1]||(s[1]=r('<p>在日常开发中出现数据卷访问不到的情况</p><p><img src="'+d+`" alt="image-20251209153907335" loading="lazy"></p><p>显示了数据卷的挂载位置但是无法进行访问</p><p>原因是 <strong><code>/var/lib/docker/volumes/</code> 根本不是 Docker 实际存储卷的目录</strong></p><p>现在容器已经正常运行，但你依然访问不到 <code>/var/lib/docker/volumes/pgdata/_data</code>，核心结论先明确：<br><strong>你查的 <code>/var/lib/docker/volumes/</code> 根本不是 Docker 实际存储卷的目录！</strong><br><code>docker volume inspect</code> 显示的 <code>Mountpoint</code> 是「Docker 默认逻辑路径」，但你的 Docker 实际数据根目录（<code>data-root</code>）被修改过，卷的真实路径不在 <code>/var/lib/docker</code> 下。</p><h3 id="第一步-立刻找到-docker-实际数据根目录-关键" tabindex="-1">第一步：立刻找到 Docker 实际数据根目录（关键！） <a class="header-anchor" href="#第一步-立刻找到-docker-实际数据根目录-关键" aria-label="Permalink to &quot;第一步：立刻找到 Docker 实际数据根目录（关键！）&quot;">​</a></h3><p>执行以下命令，<strong>必能找到真实路径</strong>：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 最权威的方式：从Docker info中提取实际根目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;docker root dir&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="示例输出-你这里大概率是类似这样" tabindex="-1">示例输出（你这里大概率是类似这样）： <a class="header-anchor" href="#示例输出-你这里大概率是类似这样" aria-label="Permalink to &quot;示例输出（你这里大概率是类似这样）：&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Docker Root Dir: /data/docker  # 这是真实路径，不是/var/lib/docker！</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="第二步-验证-pgdata-卷的真实存储位置" tabindex="-1">第二步：验证 pgdata 卷的真实存储位置 <a class="header-anchor" href="#第二步-验证-pgdata-卷的真实存储位置" aria-label="Permalink to &quot;第二步：验证 pgdata 卷的真实存储位置&quot;">​</a></h3><p>用第一步找到的「Docker Root Dir」替换 <code>/var/lib/docker</code>，执行：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 假设Docker Root Dir是/data/docker，执行：</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ld</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/docker/volumes/pgdata/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ld</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/docker/volumes/pgdata/_data</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>此时你会发现：<br> ✅ <code>pgdata</code> 目录和 <code>_data</code> 子目录都存在（因为容器已运行，卷被实际挂载）；<br> ✅ 进入该目录能看到 PostgreSQL 的数据文件（比如 <code>18/main</code> 目录，对应新版 PostgreSQL 镜像的存储结构）。</p><h3 id="为什么会出现这种「显示路径-真实路径」" tabindex="-1">为什么会出现这种「显示路径≠真实路径」？ <a class="header-anchor" href="#为什么会出现这种「显示路径-真实路径」" aria-label="Permalink to &quot;为什么会出现这种「显示路径≠真实路径」？&quot;">​</a></h3><ol><li><strong>Docker 配置被修改</strong>：<br> 运维/系统初始化时，为了节省 <code>/var</code> 分区空间，会把 Docker 的 <code>data-root</code> 改到 <code>/data</code>/<code>/opt</code> 等大分区（比如 <code>/data/docker</code>），这是生产环境的常见操作；</li><li><code>docker volume inspect</code> 的「坑」：<br> 无论 <code>data-root</code> 怎么改，<code>inspect</code> 显示的 <code>Mountpoint</code> 永远是 <code>/var/lib/docker/volumes/...</code>（这是 Docker 的显示逻辑，只展示「默认路径」，而非实际物理路径）；</li><li>容器能正常运行的原因：<br> Docker 内部会用「实际 data-root + 卷名 + _data」拼接真实路径，所以容器能挂载到卷，但你查错了目录。</li></ol><h3 id="第三步-验证-确认-彻底解决你的疑问" tabindex="-1">第三步：验证+确认（彻底解决你的疑问） <a class="header-anchor" href="#第三步-验证-确认-彻底解决你的疑问" aria-label="Permalink to &quot;第三步：验证+确认（彻底解决你的疑问）&quot;">​</a></h3><h4 id="_1-先看容器的实际挂载详情-证明卷已挂载" tabindex="-1">1. 先看容器的实际挂载详情（证明卷已挂载） <a class="header-anchor" href="#_1-先看容器的实际挂载详情-证明卷已挂载" aria-label="Permalink to &quot;1. 先看容器的实际挂载详情（证明卷已挂载）&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pgsql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Mounts&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>输出会类似（重点看 <code>Source</code> 字段）：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Mounts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;volume&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;Name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pgdata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;Source&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/data/docker/volumes/pgdata/_data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;"> 这是卷的真实路径！</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;Destination&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/var/lib/postgresql&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;Driver&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;local&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;Mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;RW&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;Propagation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这里的 <code>Source</code> 就是卷的<strong>真实物理路径</strong>，你复制这个路径执行 <code>cd</code> 就能进入：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /data/docker/volumes/pgdata/_data</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 替换成你实际的Source路径</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 能看到PostgreSQL的18/main等目录，验证成功！</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-补充-永久确认-docker-的-data-root-配置" tabindex="-1">2. 补充：永久确认 Docker 的 data-root 配置 <a class="header-anchor" href="#_2-补充-永久确认-docker-的-data-root-配置" aria-label="Permalink to &quot;2. 补充：永久确认 Docker 的 data-root 配置&quot;">​</a></h4><p>查看 Docker 配置文件，确认修改的根源：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看daemon.json配置（最常见的修改方式）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/docker/daemon.json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;data-root&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 若daemon.json无配置，查看systemd启动参数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;data-root&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h3><p>你所有的困惑都源于「信任了 <code>docker volume inspect</code> 显示的 Mountpoint，却不知道 Docker 的 data-root 被改了」。<br> 解决步骤只有两步：</p><ol><li><code>docker info | grep &quot;Docker Root Dir&quot;</code> 找真实根目录；</li><li>用真实根目录替换 <code>/var/lib/docker</code>，访问卷路径。</li></ol><p>现在执行 <code>docker info | grep &quot;Docker Root Dir&quot;</code>，把输出结果贴出来，我可以直接帮你写出能进入目录的命令。</p>`,30))])}const y=e(h,[["render",k]]);export{E as __pageData,y as default};
